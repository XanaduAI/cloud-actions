# Static Code Vulnerability Analysis Action

This GitHub Action performs security vulnerability scanning of source code using [Semgrep](https://semgrep.dev) and [Bandit](https://github.com/PyCQA/bandit) tools.

## Description

This reusable workflow analyzes your repository for security vulnerabilities by:

1. Running Semgrep scan against your codebase for general security issues
2. Running Bandit scan specifically for Python security issues

Both tools can be configured to only fail on specific severity levels, and you can optionally upload the scan reports as artifacts.

## Usage

```yaml
name: Security Scan

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  scan:
    uses: 86314-pl-secapp-scanning/cloud-actions/.github/workflows/static_code_vulnerability_analysis.yml@main
    with:
      github-repository: ${{ github.repository }}
      repository-ref: ${{ github.ref }}
```

## Inputs

### Basic Configuration

| Name | Description | Required | Default |
|------|-------------|---------|---------|
| `github-repository` | The GitHub Repository to scan | Yes | N/A |
| `repository-ref` | The branch or tag to scan | Yes | N/A |
| `runner_name` | The name of the runner to use | No | `ubuntu-latest` |
| `scan_directory` | The directory to scan within the cloned repository | No | `./` |

### Tool Selection

| Name | Description | Required | Default |
|------|-------------|---------|---------|
| `enable-bandit-scan` | Enable Bandit Scan | No | `true` |
| `enable-semgrep-scan` | Enable Semgrep Scan | No | `true` |

### Semgrep Configuration

| Name | Description | Required | Default |
|------|-------------|---------|---------|
| `semgrep-rules-file` | File name containing rules for Semgrep. The default 'auto' pulls from semgrep registry | No | `auto` |
| `semgrep-error-on-impact` | Fail job if Semgrep finds issues with this impact level or higher | No | `LOW` |
| `semgrep-error-on-severity` | Fail job if Semgrep finds issues with this severity or higher | No | `WARNING` |
| `semgrep-additional-args` | Additional arguments to pass to Semgrep | No | `''` |
| `semgrep-upload-json-report` | Upload Semgrep JSON Report | No | `false` |

### Bandit Configuration

| Name | Description | Required | Default |
|------|-------------|---------|---------|
| `bandit-config-file` | Location of Bandit Config File within the repository | No | `''` |
| `bandit-error-on-severity` | Fail job if Bandit finds issues with this severity or higher | No | `LOW` |
| `bandit-additional-args` | Additional arguments to pass to Bandit | No | `''` |
| `bandit-upload-json-report` | Upload Bandit JSON Report | No | `false` |

## Examples

### Basic Usage

```yaml
jobs:
  scan:
    uses: XanaduAI/cloud-actions/.github/workflows/static_code_vulnerability_analysis.yml@main
    with:
      github-repository: ${{ github.repository }}
      repository-ref: ${{ github.ref }}
```

### Only Fail on High Severity Issues

```yaml
jobs:
  scan:
    uses: XanaduAI/cloud-actions/.github/workflows/static_code_vulnerability_analysis.yml@main
    with:
      github-repository: ${{ github.repository }}
      repository-ref: ${{ github.ref }}
      bandit-error-on-severity: 'HIGH'
      semgrep-error-on-impact: 'HIGH'
      semgrep-error-on-severity: 'ERROR'
```

### Using Custom Bandit Configuration

```yaml
jobs:
  scan:
    uses: XanaduAI/cloud-actions/.github/workflows/static_code_vulnerability_analysis.yml@main
    with:
      github-repository: ${{ github.repository }}
      repository-ref: ${{ github.ref }}
      bandit-config-file: '.bandit.yml'  # You can also pass pyproject.toml with `[tool.bandit]` section
```

### Upload Scan Reports as Artifacts

```yaml
jobs:
  scan:
    uses: XanaduAI/cloud-actions/.github/workflows/static_code_vulnerability_analysis.yml@main
    with:
      github-repository: ${{ github.repository }}
      repository-ref: ${{ github.ref }}
      bandit-upload-json-report: true
      semgrep-upload-json-report: true
```

## Output Artifacts

When enabled, the following artifacts will be uploaded:

- `semgrep_raw_report`: The complete JSON output from Semgrep
- `semgrep_filtered_report`: Only the issues that meet the configured impact and severity thresholds
- `bandit_raw_report`: The complete JSON output from Bandit
- `bandit_filtered_report`: Only the issues that meet the configured severity threshold

## Severity/Impact Levels

### Semgrep
- Impact: LOW, MEDIUM, HIGH
- Severity: WARNING, ERROR, CRITICAL

### Bandit
- Severity: LOW, MEDIUM, HIGH