name: lint
description: |
  Run formatters/linters to OG specifications

inputs:
  base_branch:
    description: The base branch of the PR.
    required: true

runs:
  using: "composite"
  steps:
    - run: | 
          pip install black isort docformatter flake8
      shell: bash

    - run: |
          MODIFIED_PY_FILES="$(git diff origin/${{ inputs.base_branch }} --diff-filter=MAC --name-only | grep -i '\.py$' | xargs -r realpath)"
          if [ -n "${MODIFIED_PY_FILES}" ]; then \
            echo "Running black..." ; \
            black ${MODIFIED_PY_FILES} ; \
            echo "Running isort..." ; \
            isort --profile=black ${MODIFIED_PY_FILES} ; \
            echo "Running docformatter..." ; \
            docformatter --recursive --in-place --wrap-summaries 88 --wrap-descriptions 88 ${MODIFIED_PY_FILES} ; \
            echo "Running flake8..." ; \
            flake8 --ignore=E203,E501,W503 ${MODIFIED_PY_FILES} ; \
          fi
      shell: bash
